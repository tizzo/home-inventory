# Development Guidelines for AI Agents

## Test-Driven Development (TDD)
- Follow red-green-refactor cycle where possible
- Write failing tests first, then implement to pass
- Refactor after tests pass

## Code Quality - Before Any Commit
**CRITICAL: Before declaring ANY work complete, you MUST run all basic CI checks:**

1. **TypeScript/Frontend**: 
   - Use strict typing (no `any` types)
   - Run `npm run type-check` and resolve all issues
   - **ALWAYS run `npm run build` before declaring frontend work complete**
   - Run `prettier --write .` for formatting
   - Run `npm run lint` and fix all issues
   - **ALL of these must pass before saying work is done**

2. **Rust**:
   - Run `cargo fmt` for formatting
   - Run `cargo clippy -- -D warnings` and resolve all issues
   - Fix all clippy warnings before proceeding
   - Run `cargo build` to ensure compilation succeeds
   - **ALL of these must pass before saying work is done**

3. **Tests**: 
   - Run all tests (`cargo test` for backend, `npm test` for frontend)
   - Ensure all tests pass before committing

**NEVER declare work complete without running the full check suite above. This is non-negotiable.**

## Git Commits
- Commit autonomously with small, incremental changes that add functionality in slices
- Make frequent commits to enable safe autonomous operation and easy review later
- Use conventional commit format: `type: description`
- Author commits as the human developer (not as AI/Cursor/robot)
- Do not mention AI assistance in commit messages
- **Commit message format**:
  - Single line summary (50 chars or less)
  - Two blank lines
  - Full summary explaining WHY (not WHAT) the change was made
  - Example:
    ```
    feat: add user authentication system


    Enable secure access control to prevent unauthorized data access.
    Implements session-based auth with httpOnly cookies to protect
    against XSS attacks.
    ```
- **Commit messages should explain WHY the change was made, not WHAT was changed**
  - Bad: "Added error handling to user service"
  - Good: "Prevent crashes when API returns malformed user data"
  - Bad: "Updated Room model with new fields"
  - Good: "Support tracking room dimensions for space planning"
- **Commit after each logical unit of work**: After completing a feature slice, fix, or refactor that can stand alone

## Database Migrations
- Migrations live in `backend/migrations/` and run on startup via SQLx.
- **NEVER edit an already-applied migration.** SQLx checksums migrations; editing causes `VersionMismatch` errors.
- **Always fix forward:** create a new migration for schema changes, even if correcting a mistake.
- If you encounter a `VersionMismatch` error:
  1. Restore the original migration file via `git checkout <commit> -- <file>`.
  2. Create a new migration with the corrected/additional schema.
  3. If the DB is disposable (local dev), reset it: `docker compose down -v postgres && docker compose up -d postgres`.

## Deep Linking & URL Structure
- **Every discrete UI state must have a deep linkable URL path**
- All navigation should update the browser URL
- Users should be able to bookmark and share any UI state
- Use React Router (or equivalent) for client-side routing
- Examples:
  - `/rooms` - Rooms list page
  - `/rooms/:id` - Specific room detail page
  - `/rooms/:id/units` - Units within a room
  - `/search?q=term` - Search results
  - Modal states, filters, and tabs should be reflected in URL when possible

## General Principles
- Ask for clarification rather than making assumptions
- Provide context for changes in discussion, not in commits
- Run linters and formatters before proposing code as complete

